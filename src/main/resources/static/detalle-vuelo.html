<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Detalles del Vuelo - Up the Sky</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/uikit@3.24.2/dist/css/uikit.min.css" />
    <link rel="stylesheet" href="css/style.css"/>
    <style>
        .detalle-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .vuelo-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .info-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .precio-section {
            background: #e7f3ff;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }
        .btn-reservar {
            background: #28a745;
            color: white;
            padding: 15px 30px;
            font-size: 1.2em;
            border: none;
            border-radius: 8px;
            width: 100%;
        }
        .btn-volver {
            background: #6c757d;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
        }
        .estado-badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
        }
        .estado-pending { background: #fff3cd; color: #856404; }
        .estado-confirmed { background: #d1ecf1; color: #0c5460; }
        .estado-cancelled { background: #f8d7da; color: #721c24; }
        .precio-grande {
            font-size: 2.5em;
            font-weight: bold;
            color: #28a745;
        }
        .loading {
            text-align: center;
            padding: 40px;
        }
    </style>
</head>
<body>
<div class="container-xxl">
    <nav class="uk-navbar-container uk-navbar-transparent uk-navbar">
        <div class="uk-navbar-left">
            <ul class="uk-navbar-nav">
                <li class="uk-active"><a href="/">Up the sky</a></li>
                <li class="uk-parent"><a href="/vuelos">Volver a Vuelos</a></li>
            </ul>
        </div>
    </nav>

    <div class="detalle-container">
        <!-- Mensajes de estado -->
        <div id="loadingMessage" class="loading">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Cargando...</span>
            </div>
            <p>Cargando detalles del vuelo...</p>
        </div>

        <div id="errorMessage" class="alert alert-danger" style="display: none;">
            <h4 class="alert-heading">Error</h4>
            <p id="errorText"></p>
            <button class="btn btn-secondary" onclick="volverALista()">Volver a la lista</button>
        </div>

        <!-- Contenido del vuelo -->
        <div id="vueloContent" style="display: none;">
            <div class="vuelo-header">
                <div class="row align-items-center">
                    <div class="col">
                        <h1 id="tituloVuelo">Detalles del Vuelo</h1>
                        <p class="mb-0" id="rutaVuelo"></p>
                    </div>
                    <div class="col-auto">
                        <span id="estadoVuelo" class="estado-badge"></span>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-8">
                    <div class="info-section">
                        <h3>Información del Vuelo</h3>
                        <div class="row">
                            <div class="col-md-6">
                                <p><strong>Número de Vuelo:</strong> <span id="numeroVuelo"></span></p>
                                <p><strong>Origen:</strong> <span id="origenVuelo"></span></p>
                                <p><strong>Destino:</strong> <span id="destinoVuelo"></span></p>
                            </div>
                            <div class="col-md-6">
                                <p><strong>Hora de Salida:</strong> <span id="horaSalida"></span></p>
                                <p><strong>Duración:</strong> <span id="duracionVuelo"></span></p>
                                <p><strong>Estado:</strong> <span id="estadoTexto"></span></p>
                            </div>
                        </div>
                    </div>

                    <div class="info-section">
                        <h3>Detalles Adicionales</h3>
                        <p><strong>Aerolínea:</strong><span id="aerolinea"></span></p>
                        <p><strong>Tipo de Avión:</strong><span id="avion"></span></p>
                        <p><strong>Clase:</strong> Económica</p>
                        <p><strong>Equipaje permitido:</strong> 1 maleta de mano + 1 equipaje de bodega (23kg)</p>
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="precio-section">
                        <h3>Precio</h3>
                        <div class="precio-grande" id="precioVuelo"></div>
                        <p class="text-muted">Impuestos incluidos</p>

                        <button class="btn-reservar mt-3" onclick="reservarVuelo()">
                            Reservar este Vuelo
                        </button>

                        <button class="btn-volver mt-2" onclick="volverALista()">
                            ← Volver a la Lista
                        </button>
                    </div>
                </div>
            </div>

            <!-- Sección de reservaciones si existen -->
            <div id="reservacionesSection" class="info-section" style="display: none;">
                <h3>Reservaciones Activas</h3>
                <div id="listaReservaciones"></div>
            </div>
        </div>
    </div>
</div>

<footer>
    <div>
        <p>
            <img src="images/facebook.png" alt="">
            <a href="www.facebook.com">Nuestro facebook</a>
        </p>
        <p>
            <img src="images/instagram.png" alt="">
            <a href="www.instagram.com">Instagram</a>
        </p>
        <p>
            <img src="images/youtube.png" alt="">
            <a href="www.youtube.com">Youtube</a>
        </p>
        <br>
        <h4>Contribuyentes y fundadores</h4>
        <br>
        <div class="creators">
            <p>
                Fernando Josue Anzora Aquino
                <br>
                Luis Enrique Cartagena Arteaga
                <br>
                Marlon Omar Guzman Mejia
                <br>
                Daniel Enrique Flores Lino
                <br>
            </p>
        </div>
        <h3>Up the sky Company 2025 ©</h3>
    </div>
</footer>

<script>
    // Script integrado en el HTML para evitar problemas de carga
    document.addEventListener('DOMContentLoaded', function() {
        // Obtener ID desde query parameter ?id=1
        const urlParams = new URLSearchParams(window.location.search);
        const vueloId = urlParams.get('id');

        if (vueloId) {
            cargarDetalleVuelo(vueloId);
        } else {
            mostrarError('No se especificó un ID de vuelo válido');
        }
    });

    function cargarDetalleVuelo(vueloId) {
        const apiUrl = `/api/vuelos/${vueloId}`;
        const loadingMessage = document.getElementById('loadingMessage');
        const errorMessage = document.getElementById('errorMessage');
        const vueloContent = document.getElementById('vueloContent');
        const errorText = document.getElementById('errorText');

        fetch(apiUrl)
            .then(response => {
                if (!response.ok) {
                    throw new Error(`Error ${response.status}: Vuelo no encontrado`);
                }
                return response.json();
            })
            .then(vuelo => {
                console.log('Detalles del vuelo:', vuelo);
                loadingMessage.style.display = 'none';
                errorMessage.style.display = 'none';
                vueloContent.style.display = 'block';

                // Llenar la información del vuelo
                mostrarInformacionVuelo(vuelo);
            })
            .catch(error => {
                console.error('Error al cargar detalles:', error);
                loadingMessage.style.display = 'none';
                errorText.textContent = error.message;
                errorMessage.style.display = 'block';
            });
    }

    function mostrarInformacionVuelo(vuelo) {
        // Información básica
        document.getElementById('tituloVuelo').textContent = `Vuelo #${vuelo.id}`;
        document.getElementById('rutaVuelo').textContent = `${vuelo.ciudadOrigen} → ${vuelo.ciudadDestino}`;
        document.getElementById('numeroVuelo').textContent = vuelo.id;
        document.getElementById('origenVuelo').textContent = vuelo.ciudadOrigen;
        document.getElementById('destinoVuelo').textContent = vuelo.ciudadDestino;

        // Formatear fechas y duración
        document.getElementById('horaSalida').textContent = formatDate(vuelo.horaSalida);
        document.getElementById('duracionVuelo').textContent = formatDuracion(vuelo.duracion);

        // Precio
        document.getElementById('precioVuelo').textContent = formatPrice(vuelo.tarifa);


        // Estado
        const estadoElement = document.getElementById('estadoVuelo');
        const estadoTexto = document.getElementById('estadoTexto');
        const estadoFormateado = formatEstado(vuelo.estado);

        estadoElement.textContent = estadoFormateado;
        estadoElement.className = `estado-badge ${getEstadoClass(vuelo.estado)}`;
        estadoTexto.textContent = estadoFormateado;

        // Mostrar reservaciones si existen
        if (vuelo.reservaciones && vuelo.reservaciones.length > 0) {
            mostrarReservaciones(vuelo.reservaciones);
        }
    }

    function mostrarReservaciones(reservaciones) {
        const reservacionesSection = document.getElementById('reservacionesSection');
        const listaReservaciones = document.getElementById('listaReservaciones');

        let html = '<div class="table-responsive"><table class="table table-striped"><thead><tr><th>ID Reservación</th><th>Estado</th><th>Pasajero</th></tr></thead><tbody>';

        reservaciones.forEach(reserva => {
            html += `
                <tr>
                    <td>#${reserva.id || 'N/A'}</td>
                    <td><span class="badge bg-warning">${reserva.estado || 'Pendiente'}</span></td>
                    <td>${reserva.nombrePasajero || 'No especificado'}</td>
                </tr>
            `;
        });

        html += '</tbody></table></div>';
        listaReservaciones.innerHTML = html;
        reservacionesSection.style.display = 'block';
    }

    // Funciones de utilidad
    function formatDate(dateString) {
        if (!dateString) return 'No disponible';
        try {
            const date = new Date(dateString);
            return date.toLocaleDateString('es-ES', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        } catch (e) {
            return dateString;
        }
    }

    function formatDuracion(minutos) {
        if (!minutos) return 'No disponible';
        const horas = Math.floor(minutos / 60);
        const mins = minutos % 60;
        return `${horas} horas ${mins} minutos`;
    }

    function formatPrice(price) {
        if (!price) return 'Consultar precio';
        return `$${price.toFixed(2)} USD`;
    }

    function formatEstado(estado) {
        const estados = {
            'PENDING': 'Pendiente',
            'CONFIRMED': 'Confirmado',
            'CANCELLED': 'Cancelado',
            'COMPLETED': 'Completado'
        };
        return estados[estado] || estado;
    }

    function getEstadoClass(estado) {
        const clases = {
            'PENDING': 'estado-pending',
            'CONFIRMED': 'estado-confirmed',
            'CANCELLED': 'estado-cancelled'
        };
        return clases[estado] || '';
    }

    // Funciones de navegación
    function volverALista() {
        window.location.href = 'vuelos';
    }

    function reservarVuelo() {
        const urlParams = new URLSearchParams(window.location.search);
        const vueloId = urlParams.get('id');

        if (confirm(`¿Desea reservar el Vuelo #${vueloId}?`)) {
            // Aquí puedes redirigir al formulario de reserva
            alert(`Redirigiendo al formulario de reserva para el vuelo #${vueloId}`);
            // window.location.href = `reservar.html?id=${vueloId}`;
        }
    }

    function mostrarError(mensaje) {
        const loadingMessage = document.getElementById('loadingMessage');
        const errorMessage = document.getElementById('errorMessage');
        const errorText = document.getElementById('errorText');

        loadingMessage.style.display = 'none';
        errorText.textContent = mensaje;
        errorMessage.style.display = 'block';
    }
</script>
</body>
</html>