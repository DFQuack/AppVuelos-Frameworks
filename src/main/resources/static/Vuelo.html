<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Vuelos - Up the Sky</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/uikit@3.24.2/dist/css/uikit.min.css" />
    <link rel="stylesheet" href="css/style.css"/>
    <style>
        .vuelo-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            background-color: #fff3cd;

        }
        .vuelo-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .vuelo-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            color: #0c5460;
        }
        .loading {
            text-align: center;
            padding: 20px;
        }
        .error {
            color: red;
            text-align: center;
            padding: 20px;
        }
        .containerforms {
            min-height: 400px;
        }
        .containerforms h2 {
            color: #fff3cd;
        }
        .estado-pending {
            background-color: #fff3cd;
            color: #856404;
        }
        .estado-confirmed {
            background-color: #d1ecf1;
            color: #0c5460;
        }
    </style>
</head>
<body>
<div class="container-xxl">
    <nav class="uk-navbar-container uk-navbar-transparent uk-navbar">
        <div class="uk-navbar-left">
            <ul class="uk-navbar-nav">
                <li class="uk-active"><a href="">Up the sky</a></li>
                <li class="uk-parent"><a href="">Reservar Vuelo</a></li>
                <li class="uk-parent"><a href="">Divisa Actual 🇺🇸 USD</a></li>
            </ul>
        </div>
    </nav>
    <br>

    <div class="containerforms">
        <h2>Lista de Vuelos Disponibles</h2>
        <div id="loadingMessage" class="loading">
            <p>Cargando vuelos...</p>
        </div>
        <div id="errorMessage" class="error" style="display: none;">
            <p>Error al cargar los vuelos. Inténtelo de nuevo más tarde.</p>
        </div>
        <div id="vuelosList" class="row">
            <!-- Los vuelos se cargarán aquí dinámicamente -->
        </div>
    </div>

    <br>
</div>

<footer>
    <div>
        <p>
            <img src="images/facebook.png" alt="">
            <a href="www.facebook.com">Nuestro facebook</a>
        </p>
        <p>
            <img src="images/instagram.png" alt="">
            <a href="www.instagram.com">Instagram</a>
        </p>
        <p>
            <img src="images/youtube.png" alt="">
            <a href="www.youtube.com">Youtube</a>
        </p>
        <br>
        <h4>Contribuyentes y fundadores</h4>
        <br>
        <div class="creators">
            <p>
                Fernando Josue Anzora Aquino
                <br>
                Luis Enrique Cartagena Arteaga
                <br>
                Marlon Omar Guzman Mejia
                <br>
                Daniel Enrique Flores Lino
                <br>
            </p>
        </div>
        <h3>Up the sky Company 2025 ©</h3>
    </div>
</footer>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const apiUrl = '/api/vuelos';
        const vuelosList = document.getElementById('vuelosList');
        const loadingMessage = document.getElementById('loadingMessage');
        const errorMessage = document.getElementById('errorMessage');

        function formatDate(dateString) {
            if (!dateString) return 'No disponible';
            try {
                const date = new Date(dateString);
                return date.toLocaleDateString('es-ES', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            } catch (e) {
                return dateString;
            }
        }

        function formatPrice(price) {
            if (!price) return 'Consultar';
            return `$${price.toFixed(2)} USD`;
        }

        function formatDuracion(minutos) {
            if (!minutos) return 'No disponible';
            const horas = Math.floor(minutos / 60);
            const mins = minutos % 60;
            return `${horas}h ${mins}m`;
        }

        function formatEstado(estado) {
            const estados = {
                'PENDING': 'Pendiente',
                'CONFIRMED': 'Confirmado',
                'CANCELLED': 'Cancelado'
            };
            return estados[estado] || estado;
        }

        function getEstadoClass(estado) {
            const clases = {
                'PENDING': 'estado-pending',
                'CONFIRMED': 'estado-confirmed',
                'CANCELLED': 'estado-cancelled'
            };
            return clases[estado] || '';
        }

        function createVueloCard(vuelo) {
            return `
                <div class="col-md-6 col-lg-4">
                    <div class="vuelo-card">
                        <div class="vuelo-header">
                            <h5>Vuelo #${vuelo.id || 'N/A'}</h5>
                            <span class="badge bg-primary">${formatPrice(vuelo.tarifa)}</span>
                        </div>
                        <div class="vuelo-info">
                            <div>
                                <strong>Origen:</strong> ${vuelo.ciudadOrigen || 'No disponible'}
                            </div>
                            <div>
                                <strong>Destino:</strong> ${vuelo.ciudadDestino || 'No disponible'}
                            </div>
                            <div>
                                <strong>Salida:</strong> ${formatDate(vuelo.horaSalida)}
                            </div>
                            <div>
                                <strong>Duración:</strong> ${formatDuracion(vuelo.duracion)}
                            </div>
                            <div>
                                <strong>Estado:</strong>
                                <span class="badge ${getEstadoClass(vuelo.estado)}">${formatEstado(vuelo.estado)}</span>
                            </div>
                        </div>
                        <div class="mt-3">
                            <button class="btn btn-primary btn-sm" onclick="reservarVuelo(${vuelo.id})">Reservar</button>
                            <button class="btn btn-outline-secondary btn-sm" onclick="verDetalles(${vuelo.id})">Detalles</button>
                        </div>
                    </div>
                </div>
            `;
        }

        function cargarVuelos() {
            fetch(apiUrl)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Error en la respuesta del servidor: ' + response.status);
                    }
                    return response.json();
                })
                .then(vuelos => {
                    console.log('Vuelos recibidos:', vuelos); // Para debug
                    loadingMessage.style.display = 'none';

                    if (vuelos && vuelos.length > 0) {
                        const vuelosHTML = vuelos.map(vuelo => createVueloCard(vuelo)).join('');
                        vuelosList.innerHTML = vuelosHTML;
                    } else {
                        vuelosList.innerHTML = '<div class="col-12"><p>No hay vuelos disponibles en este momento.</p></div>';
                    }
                })
                .catch(error => {
                    console.error('Error al cargar vuelos:', error);
                    loadingMessage.style.display = 'none';
                    errorMessage.innerHTML = `<p>Error al cargar los vuelos: ${error.message}</p>`;
                    errorMessage.style.display = 'block';
                });
        }

        cargarVuelos();
    });

    function reservarVuelo(id) {
        alert(`Función de reserva para vuelo #${id} - Esta funcionalidad debe implementarse`);
    }

    function verDetalles(id) {
        // Redirigir a la página de detalles del vuelo
        window.location.href = `detalle-vuelo.html?id=${id}`;
    }
</script>
</body>
</html>